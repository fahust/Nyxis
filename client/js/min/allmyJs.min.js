const serverUrl="https://9rotklamvhur.usemoralis.com:2053/server",appId="YsHmEnYCWJrVMysXSmrdIwsp0MJsna1K0bsXgben",CONTRACT_ADDRESS="0xb2000CB13790af91a69c639fdc64d6cB05EEE159";var myMysticId=void 0;async function startMain(){Moralis.start({serverUrl:serverUrl,appId:appId}),document.getElementById("btn-login").onclick=login,document.getElementById("btn-log-meta").onclick=login,document.getElementById("btn-logout").onclick=logOut,window.web3=await Moralis.Web3.enableWeb3(),console.log(window.web3);let abi=await getAbi();console.log(web3.eth);let contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS),eggOneRemain=await contract.methods.getParamsContract("eggOneRemain").call({from:ethereum.selectedAddress}),eggTwoRemain=await contract.methods.getParamsContract("eggTwoRemain").call({from:ethereum.selectedAddress}),eggThreeRemain=await contract.methods.getParamsContract("eggThreeRemain").call({from:ethereum.selectedAddress});$(".iconic-egg-remain").html("( "+eggOneRemain+" / 100 )"),$(".rare-egg-remain").html("( "+eggTwoRemain+" / 900 )"),$(".classic-egg-remain").html("( "+eggThreeRemain+" / 9000 )")}function randRang(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}function getRandomArbitrary(min,max){return Math.random()*(max-min)+min}async function login(){let user=Moralis.User.current();if(user)renderGame();else try{user=await Moralis.authenticate({signingMessage:"Connect to mystic tamable !"}),renderGame()}catch(error){console.log(error)}}async function logOut(){await Moralis.User.logOut(),$(".unlogged-btn").fadeIn("slow"),$(".logged-btn").fadeOut("slow"),$("#contentBody").fadeOut("slow"),$("#myMystics").html("")}function navAllUnactive(){$(".nav-link").each((function(){$(this).removeClass("active")}))}async function faq(){$(".modal-title").html("FAQ"),$(".modal-body").html('<div class="container mt-5"><h4 class="mt-5">Can I earn money by playing ? : </h4><p>Yes with the breeding system, however it will take time (one month minimum per reproduction) and each creature will be able to give only 3 eggs maximum, to limit the number of tokens.</p><h4 class="mt-5">Can we buy more than one egg ? : </h4><p>Yes, but you can only have one adult at a time, to control the speed of reproduction.</p><h4 class="mt-5">Can we sell our eggs ? : </h4><p>Yes at the minimum price or you will buy them, however this will be done only on our platform to avoid abuse.</p><h4 class="mt-5">Can my nft be lost permanently ? : </h4><p>Yes, if you treat it badly, but it happens if you don\'t take care of it for several days.</p><p>But a creature has also a limited lifespan, it will live several months, then die of old age, in this case your token is lost, you will have to have reproduced your creature before that happens not to have losses</p><h4 class="mt-5">How long will the game take me by day ? : </h4><p>In general, the game will not take you more than 10 minutes per day, you can also put your account in vacation mode as many times as you want </p></div>')}function getAbi(){return new Promise(res=>{$.getJSON("js/Token.json",json=>{res(json.abi)})})}function timeSince(date){var seconds=Math.floor((new Date-date)/1e3),interval=seconds/31536e3;return interval>1?Math.floor(interval)+" years":(interval=seconds/2592e3)>1?Math.floor(interval)+" months":(interval=seconds/86400)>1?Math.floor(interval)+" days":(interval=seconds/3600)>1?Math.floor(interval)+" hours":(interval=seconds/60)>1?Math.floor(interval)+" minutes":Math.floor(seconds)+" seconds"}startMain();const headers=document.querySelectorAll(".highlight"),modal=document.querySelector("#aboutModal");function debounce(func,wait=10,immediate=!0){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}function dynamicHeaders(e){headers.forEach(header=>{const totalScroll=modal.scrollTop+window.innerHeight,inView=totalScroll>header.offsetTop,headerBottom=header.offsetTop+header.clientHeight,notScrolledPast=headerBottom<totalScroll;console.log(`${notScrolledPast} ${header.offsetTop} ${header.clientHeight} ${totalScroll}`),inView?header.classList.add("fadeIntoView"):header.classList.remove("fadeIntoView")})}var life=0,hungry=0,cleanliness=0,moral=0,rested=0,eggs={},foods={},items={},myMystic={},invitsReceive=void 0,invitsSended=void 0,foodByZone=void 0,myMysticData=void 0,priceEth=0,paramsContract=void 0;async function mint(typeMint){let connected;if(window.web3=await Moralis.Web3.enableWeb3(),1==await window.web3.eth.net.isListening()){let abi=await getAbi(),contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS),price=0;0==typeMint&&(price=await contract.methods.getParamsContract("priceEggOne").call({from:ethereum.selectedAddress})),1==typeMint&&(price=await contract.methods.getParamsContract("priceEggTwo").call({from:ethereum.selectedAddress})),2==typeMint&&(price=await contract.methods.getParamsContract("priceEggThree").call({from:ethereum.selectedAddress}));let minted=await contract.methods.mintDelegate(typeMint).send({from:ethereum.selectedAddress,value:web3.utils.toWei(price,"wei"),gasPrice:"1"}).catch(error=>{console.log(error)}).then(success=>{console.log(success)})}}async function modalBuy(){$(".modal-body").html("<h4 class='title-first-egg'>BUY YOUR FIRST EGG</h4><p style='margin:20'>Préparer vous à acheter votre première créature</br>Ces créatures sont des NFT, échangeable et reproductible avec d'autres utilisateurs</br>Attention ils sont à durer limité, chaque mystic possède une durée de vie, soutenez le depuis sa tendre jeunesse, jusqu'au vieil age</br></p><button class='btn btn-secondary modal-close' style='margin:10px' onClick='mint()'>BUY CLASSIC EGG (3 euros)</button><button class='btn btn-secondary modal-close' style='margin:10px' onClick='mint()'>BUY RARE EGG (30 euros)</button>")}async function renderGame(){let connected;if(console.log("render"),$(".unlogged-btn").fadeOut("slow"),$("#contentBody").fadeIn("slow"),$("#myMystics").fadeOut("slow").fadeIn("slow"),$("#myEggs").fadeIn("slow"),setTimeout(()=>{let parent=$("#btn-log-meta").parent();$("#btn-log-meta").html("Your Eggs"),$("#btn-log-meta").attr("data-toggle","modal"),$("#btn-log-meta").attr("data-target","#Modal"),parent.find("h3").html("Nest"),parent.find("p").html("Explore your nest and look at your previously purchased eggs"),document.getElementById("btn-log-meta").onclick=allEggs},1e3),window.web3=await Moralis.Web3.enableWeb3(),1==await window.web3.eth.net.isListening()){console.log("connected");let abi=await getAbi(),contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS),mystics=await contract.methods.getAllTokensForUser(ethereum.selectedAddress).call({from:ethereum.selectedAddress}).catch(error=>{console.log(error)}),eggOneRemain=await contract.methods.getParamsContract("eggOneRemain").call({from:ethereum.selectedAddress}),eggTwoRemain=await contract.methods.getParamsContract("eggTwoRemain").call({from:ethereum.selectedAddress}),eggThreeRemain=await contract.methods.getParamsContract("eggThreeRemain").call({from:ethereum.selectedAddress});$(".iconic-egg-remain").html("( "+eggOneRemain+" / 100 )"),$(".rare-egg-remain").html("( "+eggTwoRemain+" / 900 )"),$(".classic-egg-remain").html("( "+eggThreeRemain+" / 9000 )");var lastMystic=void 0,lastIdMystic=void 0;$("#myMystics").html(""),await mystics.forEach(MSTC=>{contract.methods.getTokenDetails(MSTC).call({from:ethereum.selectedAddress}).catch(error=>{console.log(error)}).then(data=>{1==data.egg?(console.log("data",data),eggs[MSTC]=data):(lastMystic=data,lastIdMystic=MSTC,myMysticId=MSTC,myMystic=data)})}),setTimeout(()=>{lastMystic?(mintToNodeServer(lastMystic,lastIdMystic),$(".born").remove(),$("#nest-egg").fadeIn("slow"),$("#mail-box").fadeIn("slow"),$("#title-mystic").fadeOut(),$(".img-intro").fadeOut(),$("#subtitle-mystic").fadeOut("slow"),$(".logged-btn").fadeIn("slow")):($("#btn-logout").parent().fadeIn("slow"),$("#title-mystic").fadeIn("slow",(function(){$("#subtitle-mystic").fadeIn("slow",(function(){}))})))},500)}}function myMysticModal(){var myMisticRender=renderMysticCard(myMysticId,{mystic:myMystic},!0,ethereum.selectedAddress);$(".modal-title").html("My Mystic"),$(".modal-body").html(myMisticRender)}async function allEggs(){let connected;$(".modal-title").html("My Eggs"),$(".modal-body").html(""),1==await window.web3.eth.net.isListening()&&(renderEggs="",await Object.keys(eggs).forEach(egg=>{renderEggs+=renderEgg(egg,eggs[egg],!0,ethereum.selectedAddress)}),$(".modal-body").html(renderEggs))}async function allItems(){let connected;1==await window.web3.eth.net.isListening()&&(renderItemsHtml="",console.log("items",items),await Object.keys(items).forEach(item=>{renderItemsHtml+=renderItems(item,items[item],!0,ethereum.selectedAddress)}),$(".modal-title").html("My Items"),$(".modal-body").html(renderItemsHtml))}function allMystics(){$("#myMystics").fadeOut("slow").fadeIn("slow"),$("#myEggs").fadeOut("slow"),fetch("http://localhost:3000/getAllMystics",{method:"get",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then(res=>res.json()).then(res=>{var allMysticsRender="";Object.keys(res).forEach(MSTC=>{allMysticsRender+=renderMysticCard(res[MSTC].mystic.id,res[MSTC],parseInt(MSTC)==parseInt(ethereum.selectedAddress),MSTC)}),$(".modal-title").html("All Mystics"),$(".modal-body").html(allMysticsRender)})}async function mintToNodeServer(mystic,id){let connected;1==await window.web3.eth.net.isListening()&&($("#myInvitsSended").fadeOut("slow"),mystic&&fetch("http://localhost:3000/mint",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addr:ethereum.selectedAddress,mystic:{createdAt:mystic.params256[0],invitsSended:mystic.params256[2],numberReproduce:mystic.params256[5],parts:mystic.params8,price:mystic.params256[1],id:mystic.params256[6],egg:mystic.egg,inSell:mystic.inSell}})}).then(res=>res.json()).then(res=>{$("#myMystics").html(renderMystic(id,res.mystic,!0,ethereum.selectedAddress)),$("#myInvitsSended").fadeIn("slow"),life=res.mystic.data.life,hungry=res.mystic.data.hungry,cleanliness=res.mystic.data.cleanliness,moral=res.mystic.data.moral,rested=res.mystic.data.rested,invitsReceive=res.invitsReceive,invitsSended=res.invitsSended,foodByZone=res.mystic.data.foodByZone,myMysticData=res.mystic,console.log(res.mystic.data.foods),items=res.mystic.data.foods,reloadFoodByZone()}))}async function reloadFoodByZone(){console.log(foodByZone),null!=foodByZone&&$(".pop-food").each((function(){foodByZone[$(this).data("zone")]<Date.now()-6e4?$(this).fadeIn("slow"):$(this).fadeOut("slow")}))}async function buy(addrSeller,mystic,id){let connected;if(1==await window.web3.eth.net.isListening()){let abi=await getAbi(),contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS),buyVar=await contract.methods.purchase(addrSeller,id).send({from:ethereum.selectedAddress,value:web3.utils.toWei(JSON.parse(mystic.replaceAll("%84",'"')).price,"ether"),to:ethereum.selectedAddress,gasPrice:"1"}).catch(error=>{console.log("error transfer",error)}).then(()=>{fetch("http://localhost:3000/buyOrTransfer",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addrBuyer:ethereum.selectedAddress,addrSeller:addrSeller})}).then(res=>res.json()).then(res=>{renderGame()})})}}async function paramsMystic(id,sell,egg,invitationToReproduce){let connected;if(1==await window.web3.eth.net.isListening()){let abi=await getAbi(),contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS);await contract.methods.paramsMystic(id,sell,egg,invitationToReproduce).send({from:ethereum.selectedAddress,gasPrice:"1"}).catch(error=>{console.log("error transfer",error)}).then(()=>{renderGame()})}}async function getAllTokensForUser(){let connected;if(1==await window.web3.eth.net.isListening()){let abi=await getAbi(),contract=new web3.eth.Contract(abi,CONTRACT_ADDRESS),mystics;(await contract.methods.getAllTokensForUser(ethereum.selectedAddress).call({from:ethereum.selectedAddress}).catch(error=>{console.log(error)})).forEach(MSTC=>{console.log(MSTC.toNumber())})}}function renderMystic(id,data,owned,addr){return dataStringified=JSON.stringify(data.mystic).replaceAll('"',"%84"),date=new Date(1e3*data.mystic.createdAt),'<div class="mystic"><img src="img/ori.png" class="img-fluid rounded-start" alt="mystic"></div>'}function inAction(action){return 0==action?"In wait":1==action?"Sleep":2==action?"Search food":3==action?"Wash":4==action?"In Train":void 0}function renderMysticCard(id,data,owned,addr){return dataStringified=JSON.stringify(data.mystic).replaceAll('"',"%84"),date=new Date(1e3*data.mystic.createdAt),console.log(myMysticData),'<div class="mb-12 col m-12" ><div class="row g-0"><div class="col-md-4"><img src="img/ori.png" style="width:150px;" class="" alt="mystic"></div><div class="col-md-8"><div class="card-body"><h5 class="card-title">#'+id+"</h5>"+(owned?'<p class="card-text">'+inAction(myMysticData.data.action)+"</p>":"")+'<p class="card-text"><small class="text-muted">'+timeSince(date)+'</small></p><div class="btn-group">'+(owned?'<button type="button" onclick="action(0)" class="btn btn-primary">Stop</button>':"")+(owned?'<button type="button" onclick="action(1)" class="btn btn-success">Sleep</button>':"")+(owned?'<button type="button" onclick="action(3)" class="btn btn-secondary">Wash</button>':"")+(owned?'<button type="button" onclick="action(4)" class="btn btn-danger">Train</button>':"")+'<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button><ul class="dropdown-menu">'+(owned?'<li><a class="dropdown-item" href="#" onclick="transfer(`'+addr+'`)">Transfer</a></li>':"")+(owned?data.mystic.inSell?'<li><a class="dropdown-item inSell" href="#" onclick="paramsMystic('+id+","+!1+","+data.mystic.egg+","+data.mystic.tokenIdReproducable+')">Stop sell</a></li>':'<li><a class="dropdown-item inSell" href="#" onclick="paramsMystic('+id+","+!0+","+data.mystic.egg+","+data.mystic.tokenIdReproducable+')">Sell</a></li>':"")+(owned&&null==myMysticId&&data.mystic.egg?'<li class="born"><a class="dropdown-item" href="#" onclick="paramsMystic('+id+","+data.mystic.inSell+","+!1+","+data.mystic.tokenIdReproducable+')">Born</a></li>':"")+(owned?"":'<li><a class="dropdown-item" href="#" onclick="sendInvit('+myMysticId+","+data.mystic.inSell+","+data.mystic.egg+","+id+",`"+addr+'`)">Invitation to reproduce</a></li>')+(!owned&&data.mystic.inSell?'<li><a class="dropdown-item" href="#" onclick="buy(`'+addr+"`,`"+dataStringified+"`,"+id+')">Buy</a></li>':"")+"</ul></div></div></div></div></div>"}function renderEgg(id,data,owned,addr){return dataStringified=JSON.stringify(data).replaceAll('"',"%84"),date=new Date(1e3*data.createdAt),'<div class="col-lg-4 col-md-12 col-sm-12 col-xs-12"><div class="card '+(0==data.params256[7]?"card-second":1==data.params256[7]?"card-third":"card-fourth")+'"><div class="content"><h3 class="title">'+(0==data.params256[7]?"Iconic Egg":1==data.params256[7]?"Rare Egg":"Classic Egg")+'</h3><p class="copy">#'+id+'</p><span></span><button class="btn iconic-egg-remain"></button></div></div></div>'}function renderItems(id,data,owned,addr){return console.log(data),'<div class="mb-12 col m-12"><div class="row g-0"><div class="col-md-4"><img src="img/'+id+'.png" style="width:50px" alt="egg"></div><div class="col-md-8"><div class="card-body"><div class="btn-group"><button type="button" onclick="feed(`'+id+'`)" class="btn btn-secondary">Feed with '+id+" ("+data+")</button></div></div></div></div></div>"}async function feed(food){let connected;console.log("feed"),1==await window.web3.eth.net.isListening()&&fetch("http://localhost:3000/feed",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addr:ethereum.selectedAddress,food:food})}).then(res=>res.json()).then(res=>{foods=res.data.foods,items=res.data.items,renderGame()})}async function action(actionId){let connected;1==await window.web3.eth.net.isListening()&&fetch("http://localhost:3000/action",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addr:ethereum.selectedAddress,action:actionId})}).then(res=>res.json()).then(res=>{renderGame()})}function pickFood(name,value,foodId){fetch("http://localhost:3000/pickFood",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addr:ethereum.selectedAddress,foodId:foodId,food:{name:name,value:value}})}).then(res=>res.json()).then(res=>{foods=res.data.foods,renderGame()})}function reproduce(idTokenOne,idTokenTwo,addressTwo){getAbi().then(abi=>{fetch("http://localhost:3000/acceptInvit",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addrOne:ethereum.selectedAddress.toString(),addrTwo:addressTwo.toString(),idTokenOne:idTokenOne,idTokenTwo:idTokenTwo})}).then(res=>res.json()).then(res=>{let contract;new web3.eth.Contract(abi,CONTRACT_ADDRESS).methods.reproduce(idTokenOne,addressTwo,idTokenTwo).send({from:ethereum.selectedAddress}).catch(error=>{console.log("error transfer",error)}).then(reproduceVar=>{console.log(reproduceVar)}).then(()=>{renderGame()})})})}function renderInvits(){modalHtml='<h5>Receive</h5><div class="hiddenContainer">',invitsReceive&&Object.keys(invitsReceive).forEach(receive=>{modalHtml+='<div><a href="#" ><i class="fas fa-envelope"></i>#'+invitsReceive[receive]+'</a> <button class="btn btn-success" onclick="reproduce('+myMysticId+","+invitsReceive[receive]+",`"+receive+'`)">accept</button><button class="btn btn-danger" onclick="deleteInvitReceive('+myMysticId+",`"+receive+'`)">decline</button></div>'}),modalHtml+='</div><h5>Sended</h5><div class="hiddenContainer">',invitsSended&&Object.keys(invitsSended).forEach(sended=>{modalHtml+='<div><a href="#" ><i class="fas fa-envelope"></i>#'+invitsSended[sended]+'</a> <button class="btn btn-danger" onclick="deleteInvitSended('+invitsSended[sended]+","+sended+')">decline</button></div>'}),$(".modal-title").html("Invitation"),$(".modal-body").html(modalHtml+"</div>")}function sendInvit(idToken,sell,egg,tokenIdReproducable,addr){getAbi().then(abi=>{let contract;new web3.eth.Contract(abi,CONTRACT_ADDRESS).methods.paramsMystic(idToken,sell,egg,tokenIdReproducable).send({from:ethereum.selectedAddress}).catch(error=>{console.log("error transfer",error)}).then(()=>{fetch("http://localhost:3000/addInvit",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addrOne:ethereum.selectedAddress.toString(),addrTwo:addr.toString(),idTokenOne:myMysticId,idTokenTwo:idToken})}).then(res=>res.json()).then(res=>{})})})}function deleteInvitSended(idToken,addr){getAbi().then(abi=>{let contract;new web3.eth.Contract(abi,CONTRACT_ADDRESS).methods.paramsMystic(myMysticId,myMystic.sell,myMystic.egg,0).send({from:ethereum.selectedAddress,gasPrice:"1"}).catch(error=>{console.log("error transfer",error)}).then(invit=>{fetch("http://localhost:3000/deleteInvitSended",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addrOne:ethereum.selectedAddress,addrTwo:addr,idTokenOne:myMysticId,idTokenTwo:idToken})}).then(res=>{renderGame()})})})}function deleteInvitReceive(idToken,addr){fetch("http://localhost:3000/deleteInvitReceive",{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify({addrOne:ethereum.selectedAddress,addrTwo:addr,idTokenOne:myMysticId,idTokenTwo:idToken})}).then(res=>{renderGame()})}fetch("https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=BTC,USD,EUR",{method:"get",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then(res=>res.json()).then(res=>{console.log(priceEth=res.USD),$(".convert-eth").each((function(){$(this).html($(this).data("price")+" ETH - "+Math.round($(this).data("price")*res.USD)+" USD")}))}),$(".pop-food").each((function(){setTimeout(()=>{$(this).css("animation-duration",getRandomArbitrary(2,4)+"s")},randRang(1e3,5e3))})),$("#title-mystic").fadeIn("slow",(function(){$("#subtitle-mystic").fadeIn("slow",(function(){}))})),function(){window.addEventListener("scroll",(function(event){var depth,layer,layers,movement,topDistance,translate3d,_i,_len;for(topDistance=this.pageYOffset,_i=0,_len=(layers=document.querySelectorAll("[data-type='parallax']")).length;_i<_len;_i++)translate3d="translate3d(0, "+(movement=-topDistance*(depth=(layer=layers[_i]).getAttribute("data-depth")))+"px, 0)",layer.style["-webkit-transform"]=translate3d,layer.style["-moz-transform"]=translate3d,layer.style["-ms-transform"]=translate3d,layer.style["-o-transform"]=translate3d,layer.style.transform=translate3d}))}.call(this);